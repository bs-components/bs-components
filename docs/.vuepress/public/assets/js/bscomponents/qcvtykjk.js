/*! Built with http://stenciljs.com */
const{h:e}=window.bscomponents;import{a as t}from"./chunk-5028a50e.js";import{a as o,b as n}from"./chunk-29443f36.js";import{p as r,o as d,s,r as i,t as a,q as h}from"./chunk-89dac778.js";import{c as l}from"./chunk-79b4afa6.js";import{a as p}from"./chunk-6568b9ed.js";import{a as w}from"./chunk-c1b19ebe.js";class c{constructor(){this.showEventName="show.bs.dropdown",this.shownEventName="shown.bs.dropdown",this.hideEventName="hide.bs.dropdown",this.hiddenEventName="hidden.bs.dropdown",this.showDropdown=!1,this.show=!1,this.config={},this.defaults={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic"},this.handleDropdownClickOutside=(e=>{if(this.show){if(function(e,o){return null!==t(e,o)}(e.target,`[data-bs-id="${this.dropdownId}"]`)){const o=t(e.target,"form");if(this.dropdownEl.contains(o))return;if("input"===d(e.target.tagName)||"textarea"===d(e.target.tagName))return}document.removeEventListener("click",this.handleDropdownClickOutside),this.show=!0,this.handleHideDropdown()}}),this.handleToggleBsDropdown=(e=>{e.preventDefault(),!0===this.show?this.handleHideDropdown():this.handleShowDropdown(e.target)})}componentWillLoad(){a(this.dropdownEl,"show")&&!1===this.show&&(this.show=!0),!0===this.show&&setTimeout(()=>{document.removeEventListener("click",this.handleDropdownClickOutside),document.addEventListener("click",this.handleDropdownClickOutside)},0),this.dropdownId=n("dropdown"),this.dropdownEl.dataset.bsId=this.dropdownId;const e=this.dropdownEl.querySelectorAll('[data-toggle="dropdown"]');for(let t=0,o=e.length;t<o;t+=1)e[t].removeEventListener("click",this.handleToggleBsDropdown),e[t].addEventListener("click",this.handleToggleBsDropdown);if(!0===this.showDropdown&&!1===this.show){const e=this.dropdownEl.querySelector(".dropdown-menu");if(!e)return;const t=p(e);a(e,"fade")?(i(e,"fade"),this.handleShowDropdown(),setTimeout(()=>{s(e,"fade")},t)):this.handleShowDropdown()}else!1===this.showDropdown&&!0===this.show&&this.handleHideDropdown()}componentDidUnload(){this.dispose()}dispose(){!0===this.show&&this.handleHideDropdown(),document.removeEventListener("click",this.handleDropdownClickOutside);const e=this.dropdownEl.querySelectorAll('[data-toggle="dropdown"]');this.relatedTarget=null;for(let t=0,o=e.length;t<o;t+=1)e[t].removeEventListener("click",this.handleToggleBsDropdown);this.popperHandle&&this.popperHandle.destroy&&(this.popperHandle.destroy(),this.popperHandle=null)}initPopper(e){if(this.inNavbar=c.detectNavbar(this.dropdownEl),!this.inNavbar){const t=c.getPopperDropdownConfig(this.dropdownEl,e,this.config);"scrollParent"!==this.config.boundary&&s(this.dropdownEl,"position-static");let n=this.relatedTarget;"parent"===this.config.reference?n=this.relatedTarget.parentNode:this.config.reference instanceof Element&&(n=this.config.reference),this.popperHandle=new o(n,e,t)}}static detectNavbar(e){return null!==t(e,".navbar")}setConfig(e){this.config={};const t={};l(e.dataset,"offset")?t.offset=e.dataset.offset:t.offset=this.defaults.offset,l(e.dataset,"relatedTarget")?t.flip=w(e.dataset.flip):t.flip=this.defaults.flip,l(e.dataset,"boundary")?t.boundary=e.dataset.boundary:t.boundary=this.defaults.boundary,l(e.dataset,"reference")?t.reference=e.dataset.reference:t.reference=this.defaults.reference,l(e.dataset,"display")?t.display=e.dataset.display:t.display=this.defaults.display,this.config=t}getAssumedRelatedTarget(){return this.dropdownEl.querySelector('[data-toggle="dropdown"]')||this.dropdownEl}handleShowDropdown(e=null){if(this.relatedTarget=e||this.getAssumedRelatedTarget(),this.relatedTarget.hasAttribute("disabled")||a(this.relatedTarget,"disabled"))return;const t=h(this.dropdownEl,this.showEventName,{},this.relatedTarget);if(this.setConfig(this.relatedTarget),this.show||t.defaultPrevented)return;this.show=!0;const o=this.dropdownEl.querySelector(".dropdown-menu");if(!o)return;s(this.dropdownEl,"show"),s(o,"show"),this.relatedTarget.setAttribute("aria-expanded","true"),document.removeEventListener("click",this.handleDropdownClickOutside),setTimeout(()=>{document.removeEventListener("click",this.handleDropdownClickOutside),document.addEventListener("click",this.handleDropdownClickOutside)},0);const n=p(o);this.initPopper(o),setTimeout(()=>{h(this.dropdownEl,this.shownEventName,{},this.relatedTarget)},n)}handleHideDropdown(){const e=h(this.dropdownEl,this.hideEventName,{},this.relatedTarget);if(!this.show||e.defaultPrevented)return;this.show=!1;const t=this.dropdownEl.querySelector(".dropdown-menu");if(!t)return;const o=this.dropdownEl.querySelectorAll('[data-toggle="dropdown"]');document.removeEventListener("click",this.handleDropdownClickOutside),i(this.dropdownEl,"show"),i(t,"show");for(let e=0,t=o.length;e<t;e+=1)o[e].setAttribute("aria-expanded","false");const n=p(t);setTimeout(()=>{h(this.dropdownEl,this.hiddenEventName,{},this.relatedTarget),this.relatedTarget=null},n)}static getPlacement(e,t){let o="bottom-start";return a(e,"dropup")?(o="top-start",a(t,"dropdown-menu-right")&&(o="top-end")):a(e,"dropright")?o="right-start":a(e,"dropleft")?o="left-start":a(e,"dropdown-menu-right")&&(o="bottom-end"),o}static getPopperDropdownConfig(e,t,o){const n={placement:c.getPlacement(e,t),modifiers:{offset:{offset:o.offset},flip:{enabled:o.flip},preventOverflow:{boundariesElement:o.boundary}}};return"static"===o.display&&(n.modifiers.applyStyle={enabled:!1}),n}handleFocusOut(e){this.show&&!this.dropdownEl.contains(e.relatedTarget)&&this.handleHideDropdown()}keydownIsADropdownCommand(e){if("input"===d(e.target.tagName)||"textarea"===d(e.target.tagName)){if(32===e.which)return!1;if(27===e.which)return!0;if(this.dropdownEl.querySelector(".dropdown-menu").contains(e.target))return!1;if(40===e.which)return"dropdown"===e.target.dataset.toggle;if(38===e.which)return"dropdown"===e.target.dataset.toggle}else{if(38===e.which)return!0;if(40===e.which)return!0;if(27===e.which)return!0;if(32===e.which)return!0}return!1}handleKeyDown(e){if(!this.keydownIsADropdownCommand(e))return;if(e.preventDefault(),e.stopPropagation(),e.target.hasAttribute("disabled")||a(e.target,"disabled"))return;const t=this.getAssumedRelatedTarget();if(27===e.which)return!0===this.show?this.handleHideDropdown():this.handleShowDropdown(t),void t.focus();if(32===e.which)return void(t===document.activeElement&&(!0===this.show?this.handleHideDropdown():this.handleShowDropdown(t)));if(40===e.which&&!this.show)return this.handleShowDropdown(t),void t.focus();if(38===e.which&&!this.show)return this.handleShowDropdown(t),void t.focus();38!==e.which&&40!==e.which&&console.warn("unhandled event.which: ",e.which);const o=Array.prototype.slice.call(this.dropdownEl.querySelectorAll(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)"));if(0===o.length)return;let n=o.indexOf(document.activeElement);38===e.which&&n>0&&(n-=1),40===e.which&&n<o.length-1&&(n+=1),n<0&&(n=0),o[n].focus()}handlePresentWatch(e){!0===e&&!1===this.show?this.handleShowDropdown():!1===e&&!0===this.show&&this.handleHideDropdown()}dropdown(e={},t=null){if(0===r(e))return this.dropdownEl;if("toggle"===e)return!0===this.show?this.handleHideDropdown():this.handleShowDropdown(t),!0;if("update"===e)return this.inNavbar=c.detectNavbar(this.dropdownEl),null!==this.popperHandle&&this.popperHandle.scheduleUpdate(),!0;if("string"==typeof e)throw new Error(`No method named "${e}"`);return null}render(){return e("slot",null)}static get is(){return"bs-dropdown"}static get properties(){return{config:{type:"Any",attr:"config",mutable:!0},defaults:{type:"Any",attr:"defaults"},dropdown:{method:!0},dropdownEl:{elementRef:!0},dropdownId:{state:!0},hiddenEventName:{type:String,attr:"hidden-event-name"},hideEventName:{type:String,attr:"hide-event-name"},inNavbar:{state:!0},popperHandle:{state:!0},relatedTarget:{state:!0},show:{type:Boolean,attr:"show",mutable:!0},showDropdown:{type:Boolean,attr:"show-dropdown",reflectToAttr:!0,mutable:!0,watchCallbacks:["handlePresentWatch"]},showEventName:{type:String,attr:"show-event-name"},shownEventName:{type:String,attr:"shown-event-name"}}}static get listeners(){return[{name:"focusout",method:"handleFocusOut"},{name:"keydown",method:"handleKeyDown"}]}}export{c as BsDropdown};